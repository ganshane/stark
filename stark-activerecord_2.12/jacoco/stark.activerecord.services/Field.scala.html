<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Field.scala</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Stark Activerecord</a> &gt; <a href="index.source.html" class="el_package">stark.activerecord.services</a> &gt; <span class="el_source">Field.scala</span></div><h1>Field.scala</h1><pre class="source lang-java linenums">package stark.activerecord.services


import javax.persistence.criteria.Selection
import org.joda.time.DateTime

import scala.language.implicitConversions
import scala.reflect.runtime.universe._

/**
 * ActiveRecord field
  *
  * @author &lt;a href=&quot;mailto:jcai@ganshane.com&quot;&gt;Jun Tsai&lt;/a&gt;
 * @since 2016-03-09
 */
<span class="fc" id="L16">object Field {</span>
<span class="fc" id="L17">  def countField= new SelectionField {</span>
    override def toSelection[X]: Selection[X] = {
<span class="fc" id="L19">      val context =DSL.dslContext.value</span>
<span class="fc" id="L20">      context.builder.count(context.root).asInstanceOf[Selection[X]]</span>
    }
  }
<span class="fc" id="L23">  implicit def wrapNumericField[T&lt;:Number](field: Field[T]):NumericField[T]= new NumericField(field)</span>
<span class="fc" id="L24">  implicit def wrapNumericField[T](field: Field[T])(implicit num:Numeric[T]) = new NumericField(field)</span>
<span class="nc" id="L25">  implicit def wrapStringField(field: Field[String]):StringField = new StringField(field)</span>
<span class="nc" id="L26">  implicit def wrapDateTimeField(field: Field[DateTime]):DateTimeField= new DateTimeField(field)</span>
<span class="nc" id="L27">  implicit def wrapEnumerationField[T &lt;: Enumeration#Value](field: Field[T]):EnumerationField[T]= new EnumerationField(field)</span>
}
<span class="fc" id="L29">trait Field[+A] extends SelectionField{</span>
  val fieldName:String
  def === [B &gt;: A ](value:B): Condition
  def !==[B&gt;:A](value : B)                                 : Condition
  def !==[B &gt;: A](value : Field[B])                          : Condition
<span class="nc" id="L34">  def &lt;&gt;[B&gt;:A](value : B)= !==(value)</span>
<span class="nc" id="L35">  def &lt;&gt;[B&gt;:A](value : Field[B])= !==(value)</span>

  def isNull:Condition
  def notNull:Condition

  def desc[B &gt;: A]:SortField[B]
  def asc[B &gt;:A ]:SortField[B]
  def count:SelectionField
  def sum:SelectionField
  def distinct:SelectionField
  def max:SelectionField
}
trait SelectionField{
  def toSelection[X]:Selection[X]
}
trait DistinctSelectionField extends SelectionField{
}
<span class="pc bnc" id="L52" title="All 25 branches missed.">case class SortField[T](field: Field[T],isAsc:Boolean=true)</span>

<span class="pc" id="L54">private[activerecord] class JPAField[+T : TypeTag](val fieldName:String)  extends Field[T] {</span>
  override def ===[B &gt;: T](value: B): Condition = {
<span class="fc" id="L56">    Condition.eq(this,value)</span>
  }
<span class="nc" id="L58">  override def !==[B &gt;: T](value: B): Condition = Condition.notEq(this,value)</span>
<span class="nc" id="L59">  override def !==[B &gt;: T](value: Field[B]): Condition = Condition.notEq(this,value)</span>

<span class="fc" id="L61">  override def isNull: Condition = Condition.isNull(this)</span>
<span class="nc" id="L62">  override def notNull: Condition = Condition.notNull(this)</span>

<span class="fc" id="L64">  override def desc[B &gt;: T]: SortField[B] = SortField(this,false)</span>
<span class="fc" id="L65">  override def asc[B &gt;: T]: SortField[B] = SortField(this,isAsc = true)</span>

  override def toSelection[X]: Selection[X]= {
<span class="fc" id="L68">    DSL.dslContext.value.root.get[X](fieldName)</span>
  }
  private def expression[X]={
<span class="fc" id="L71">    DSL.dslContext.value.root.get[X](fieldName)</span>
  }

  override def count: SelectionField ={
<span class="pc bpc" id="L75" title="1 of 2 branches missed.">    new SelectionField {</span>
      override def toSelection[X]: Selection[X] = {
<span class="fc" id="L77">        DSL.dslContext.value.builder.count(expression).asInstanceOf[Selection[X]]</span>
      }
    }
  }
  override def sum: SelectionField ={
<span class="pc bpc" id="L82" title="1 of 2 branches missed.">    new SelectionField {</span>
      override def toSelection[X]: Selection[X] = {
<span class="fc" id="L84">        DSL.dslContext.value.builder.sum(expression).asInstanceOf[Selection[X]]</span>
      }
    }
  }


  override def max: SelectionField = {
<span class="pc bpc" id="L91" title="1 of 2 branches missed.">    new SelectionField {</span>
      override def toSelection[X]: Selection[X] = {
<span class="fc" id="L93">        DSL.dslContext.value.builder.max(expression).asInstanceOf[Selection[X]]</span>
      }
    }
  }

  override def distinct: SelectionField = {
<span class="pc bpc" id="L99" title="1 of 2 branches missed.">    new DistinctSelectionField {</span>
      override def toSelection[X]: Selection[X] = {
<span class="fc" id="L101">        JPAField.this.toSelection</span>
      }
    }
  }
}
<span class="fc" id="L106">class NumericField[T](field:Field[T]){</span>
  def &gt;(value:T):Condition={
<span class="fc" id="L108">    Condition.gt(field,value)</span>
  }
<span class="nc" id="L110">  def &gt;=(value: T): Condition = Condition.ge(field,value)</span>
<span class="fc" id="L111">  def &lt;(value: T): Condition = Condition.lt(field,value)</span>
<span class="nc" id="L112">  def &lt;=(value: T): Condition = Condition.le(field,value)</span>
  def avg:SelectionField = {
<span class="pc bpc" id="L114" title="1 of 2 branches missed.">    new SelectionField {</span>
      override def toSelection[X]: Selection[X] = {
<span class="fc" id="L116">        val expression = DSL.dslContext.value.root.get[Number](field.fieldName)</span>
<span class="fc" id="L117">        DSL.dslContext.value.builder.avg(expression).asInstanceOf[Selection[X]]</span>
      }
    }
  }
  def max:SelectionField={
<span class="nc bnc" id="L122" title="All 2 branches missed.">    new SelectionField {</span>
      override def toSelection[X]: Selection[X] = {
<span class="nc" id="L124">        val expression = DSL.dslContext.value.root.get[Number](field.fieldName)</span>
<span class="nc" id="L125">        DSL.dslContext.value.builder.max(expression).asInstanceOf[Selection[X]]</span>
      }
    }
  }
  def min:SelectionField={
<span class="pc bpc" id="L130" title="1 of 2 branches missed.">    new SelectionField {</span>
      override def toSelection[X]: Selection[X] = {
<span class="fc" id="L132">        val expression = DSL.dslContext.value.root.get[Number](field.fieldName)</span>
<span class="fc" id="L133">        DSL.dslContext.value.builder.min(expression).asInstanceOf[Selection[X]]</span>
      }
    }
  }
  def sum:SelectionField={
<span class="nc bnc" id="L138" title="All 2 branches missed.">    new SelectionField {</span>
      override def toSelection[X]: Selection[X] = {
<span class="nc" id="L140">        val expression = DSL.dslContext.value.root.get[Number](field.fieldName)</span>
<span class="nc" id="L141">        DSL.dslContext.value.builder.sum(expression).asInstanceOf[Selection[X]]</span>
      }
    }
  }
}
<span class="pc" id="L146">class StringField(field:Field[String]){</span>
<span class="nc" id="L147">  def like(value: String): Condition = Condition.like(field,value)</span>
<span class="nc" id="L148">  def notLike(value: String): Condition = Condition.notLike(field,value)</span>
}
<span class="nc" id="L150">class DateTimeField(field:Field[DateTime]){</span>
  def &gt;(value:DateTime):Condition={
<span class="nc" id="L152">    Condition.gt(field,value)</span>
  }
  def &lt;(value:DateTime):Condition={
<span class="nc" id="L155">    Condition.lt(field,value)</span>
  }
}
<span class="nc" id="L158">class EnumerationField[T&lt;: Enumeration#Value](field:Field[T]){</span>
  def &gt;(value:T):Condition={
<span class="nc" id="L160">    Condition.gt(field,value)</span>
  }
  def &gt;=(value:T):Condition={
<span class="nc" id="L163">    Condition.ge(field,value)</span>
  }
  def &lt;(value:T):Condition={
<span class="nc" id="L166">    Condition.lt(field,value)</span>
  }
  def &lt;= (value:T):Condition={
<span class="nc" id="L169">    Condition.le(field,value)</span>
  }
<span class="nc" id="L171">}</span>
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>